<div class="flex flex-col h-screen transition-all duration-500" 
  (click)="onClickOutside($event)"
  [ngClass]="{
    'bg-gradient-to-br from-slate-900 via-blue-900 to-indigo-900': isDarkMode,
    'bg-gradient-to-br from-orange-50 via-white to-orange-100': !isDarkMode
  }">
  <!-- Header -->
  <div class="backdrop-blur-md border-b p-4 shadow-2xl transition-all duration-500 flex justify-between items-center" [ngClass]="{
    'bg-navy-glass border-white/10 text-white': isDarkMode,
    'bg-white/20 border-white/30 text-orange-800': !isDarkMode
  }">
    <div class="flex items-center gap-2">
      <h1 class="text-xl font-bold bg-gradient-to-r bg-clip-text text-transparent transition-all duration-500" [ngClass]="{
        'from-blue-400 to-cyan-300': isDarkMode,
        'from-orange-600 to-orange-800': !isDarkMode
      }">GenAI Chatbot</h1>
    </div>
    <div>
      <p class="text-sm transition-all duration-500" [ngClass]="{
        'text-blue-200/80': isDarkMode,
        'text-orange-600/80': !isDarkMode
      }">Ask me anything!</p>
    </div>
    <!-- iPhone Style Toggle -->
    <div class="relative">
      <button (click)="toggleTheme()" class="iphone-toggle" [ngClass]="{'active': isDarkMode}">
        <div class="toggle-slider">
          <div class="toggle-icon sun-icon" [ngClass]="{'hidden': isDarkMode}">‚òÄÔ∏è</div>
          <div class="toggle-icon moon-icon" [ngClass]="{'hidden': !isDarkMode}">üåô</div>
        </div>
      </button>
    </div>
  </div>

  <!-- Messages Container -->
  <div class="flex-1 overflow-y-auto p-3 sm:p-4 space-y-3 sm:space-y-4">
    <div class="max-w-4xl mx-auto">
      <app-message 
        *ngFor="let message of messages" 
        [message]="message"
        [isDarkMode]="isDarkMode">
      </app-message>
      <!-- Typing Indicator -->
      <div *ngIf="isTyping" class="flex justify-start mb-3 sm:mb-4">
        <div class="backdrop-blur-sm border rounded-xl px-4 py-2 animate-pulse shadow-xl transition-all duration-500" [ngClass]="{
          'bg-navy-glass border-white/20': isDarkMode,
          'bg-white/40 border-white/50': !isDarkMode
        }">
          <div class="flex space-x-1">
            <div class="w-2 h-2 rounded-full animate-bounce transition-all duration-500" [ngClass]="{
              'bg-blue-400': isDarkMode,
              'bg-orange-400': !isDarkMode
            }"></div>
            <div class="w-2 h-2 rounded-full animate-bounce transition-all duration-500" [ngClass]="{
              'bg-blue-400': isDarkMode,
              'bg-orange-400': !isDarkMode
            }" style="animation-delay: 0.1s"></div>
            <div class="w-2 h-2 rounded-full animate-bounce transition-all duration-500" [ngClass]="{
              'bg-blue-400': isDarkMode,
              'bg-orange-400': !isDarkMode
            }" style="animation-delay: 0.2s"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Input Area -->
  <div class="backdrop-blur-md border-t p-4 pb-safe transition-all duration-500" [ngClass]="{
    'bg-navy-glass border-white/10': isDarkMode,
    'bg-white/20 border-white/30': !isDarkMode
  }">
    <div class="flex gap-3 max-w-4xl mx-auto items-end relative">
      <input 
        type="text" 
        [(ngModel)]="currentMessage"
        (keypress)="onKeyPress($event)"
        placeholder="Type your message..."
        class="flex-1 backdrop-blur-sm border rounded-2xl px-4 py-4 text-base focus:outline-none focus:ring-2 focus:border-transparent transition-all duration-500 min-h-[52px] resize-none"
        [ngClass]="{
          'bg-navy-glass border-white/20 placeholder-blue-300/50 text-white focus:ring-blue-400': isDarkMode,
          'bg-white/50 border-white/60 placeholder-orange-400/70 text-orange-800 focus:ring-orange-400': !isDarkMode
        }"
        [disabled]="isTyping">
      
      <!-- Model Selector Button -->
      <div class="relative model-selector">
        <button 
          (click)="toggleModelDropdown()"
          class="w-12 h-12 rounded-2xl backdrop-blur-sm border flex items-center justify-center transition-all duration-300 hover:scale-105" 
          [ngClass]="{
            'bg-navy-glass border-white/20 text-blue-200 hover:bg-white/10': isDarkMode,
            'bg-white/50 border-white/60 text-orange-700 hover:bg-white/60': !isDarkMode
          }"
          title="Select AI Model">
          <span class="text-lg font-bold">
            {{getSelectedModelIcon()}}
          </span>
        </button>
        
        <!-- Model Selection Popup -->
        <div *ngIf="showModelDropdown" class="absolute bottom-full right-0 mb-2 w-80 backdrop-blur-md border rounded-xl shadow-2xl z-50 transition-all duration-300" 
          [ngClass]="{
            'bg-navy-glass border-white/20': isDarkMode,
            'bg-white/95 border-white/50': !isDarkMode
          }">
          <div class="p-4">
            <h3 class="text-lg font-bold mb-3 transition-all duration-500" [ngClass]="{
              'text-blue-200': isDarkMode,
              'text-orange-800': !isDarkMode
            }">Select AI Model</h3>
            
            <div class="space-y-2">
              <div *ngFor="let model of availableModels" 
                (click)="selectModel(model.id)"
                class="flex items-center gap-3 p-3 rounded-xl cursor-pointer transition-all duration-200 hover:scale-[1.02]" 
                [ngClass]="{
                  'hover:bg-white/10 text-blue-200': isDarkMode && model.id !== selectedModel,
                  'bg-blue-500/20 text-blue-300 ring-2 ring-blue-400/30': isDarkMode && model.id === selectedModel,
                  'hover:bg-white/60 text-orange-700': !isDarkMode && model.id !== selectedModel,
                  'bg-orange-500/20 text-orange-800 ring-2 ring-orange-400/30': !isDarkMode && model.id === selectedModel
                }">
                <span class="w-10 h-10 rounded-full flex items-center justify-center text-lg font-bold" 
                  [ngClass]="{
                    'bg-blue-500 text-white': isDarkMode,
                    'bg-orange-500 text-white': !isDarkMode
                  }">
                  {{model.icon}}
                </span>
                <div class="flex-1">
                  <div class="font-semibold">{{model.name}}</div>
                  <div class="text-sm opacity-70">{{model.provider}}</div>
                </div>
                <div *ngIf="model.id === selectedModel" class="w-3 h-3 rounded-full" 
                  [ngClass]="{
                    'bg-blue-400': isDarkMode,
                    'bg-orange-500': !isDarkMode
                  }"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <button 
        (click)="sendMessage()"
        [disabled]="!currentMessage.trim() || isTyping"
        class="text-white px-6 py-4 rounded-2xl disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-500 transform hover:scale-105 shadow-xl backdrop-blur-sm min-h-[52px] font-medium flex-shrink-0"
        [ngClass]="{
          'bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600': isDarkMode,
          'bg-gradient-to-r from-orange-400 to-orange-500 hover:from-orange-500 hover:to-orange-600': !isDarkMode
        }">
        Send
      </button>
    </div>
    
    <!-- Copyright -->
    <div class="text-center mt-3 text-xs transition-all duration-500" [ngClass]="{
      'text-blue-200/60': isDarkMode,
      'text-orange-600/60': !isDarkMode
    }">
      ¬© 2025 <a href="https://amnnrajbhar.github.io/info/" target="_blank" class="hover:underline transition-all duration-300" [ngClass]="{
        'text-blue-300 hover:text-blue-200': isDarkMode,
        'text-orange-700 hover:text-orange-800': !isDarkMode
      }">Aman Rajbhar</a>
    </div>
  </div>
</div>